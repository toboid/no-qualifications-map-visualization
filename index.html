<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="libraries/d3.v3.js"></script>
    <script src="libraries/topojson.v0.js"></script>
    <script src="data/unqualified.js"></script>
    <script src="data/boundaries.js"></script>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/colorbrewer.css" />
</head>
<body>
    <svg id="map" width="960" height="1160">
        <defs>
          <filter xmlns="http://www.w3.org/2000/svg" id="dropshadow" height="130%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="3"/> 
<!--              <feOffset dx="2" dy="2" result="offsetblur"/> -->
              <feMerge> 
                <feMergeNode/>
                <feMergeNode in="SourceGraphic"/> 
              </feMerge>
           </filter>
        </defs>
    </svg>
    <script>
        //var width = 960,
        //    height = 1160;

        //var svg = d3.select("body").append("svg")
        //    .attr("width", width)
        //    .attr("height", height);

        var svg = d3.select("#map");
        var width = svg.attr("width"),
            height = svg.attr("height");

        //var projection = d3.geo.mercator()
        //    .scale(20000)
        //    .center([0, 55.4])
        //    .translate([width / 2, (height / 2)] );

        var projection = d3.geo.albers()
            .center([0, 55.4])
            .rotate([4.4, 0])
            .parallels([50, 60])
            .scale(6000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path().projection(projection);
        var colourScale = d3.scale.quantize()
            .domain([unqualified.summary.min_percent, unqualified.summary.max_percent])
            .range(d3.range(9).map(function (i) { return "q" + i + "-9"; }));

        // External boundary.
        svg.append("path")
            .datum(topojson.mesh(boundaries, boundaries.objects.regions, function (a, b) { return a === b }))
            .attr("d", path)
            .attr("class", "cntry-bndry-ext")
            .attr("filter", "url(#dropshadow)");

        // Constituencies.
        svg.append("g")
            .attr("class", "Greens constituency")
            .selectAll("path")
            .data(topojson.object(boundaries, boundaries.objects.constituencies).geometries)
            .enter().append("path")
            .attr("class", function (d) {
                return colourScale(unqualified.data[d.id].percent_unqual);
            })
            .attr("d", path);

        // Regions.
        svg.append("g")
            .attr("class", "region")
            .selectAll("path")
            .data(topojson.object(boundaries, boundaries.objects.regions).geometries)
            .enter().append("path")
            .attr("d", path);

        //// Regions.
        //svg.append("g")
        //    .attr("class", "region-btn")
        //    .selectAll("path")
        //    .data(topojson.object(boundaries, boundaries.objects.regions).geometries)
        //    .enter().append("path")
        //    .attr("d", path);

        //svg.append("g")
        //    .attr("id", "region-int-bndrys")
        //    .append("path")
        //    .datum(topojson.mesh(boundaries, boundaries.objects.regions, function (a, b) { return a !== b }))
        //    .attr("d", path)
        //    .attr("class", "region");

        console.log(topojson.object(boundaries, boundaries.objects.constituencies));
        console.log(topojson.object(boundaries, boundaries.objects.regions));

        // TODO - want this?
        boundaries = null;
    </script>
</body>
</html>