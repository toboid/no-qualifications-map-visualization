<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="libraries/d3.v3.js"></script>
    <script src="libraries/topojson.v0.js"></script>
    <script src="data/countries_topo.js"></script>
    <script src="data/constituencies_topo_0.4.js"></script>
    <script src="data/unqualified.js"></script>
    <!--TODO - remove--><script src="scratch.js"></script>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/colorbrewer.css" />
</head>
<body>
    <script>
        var width = 960,
            height = 1160;

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        //var projection = d3.geo.mercator()
        //    .scale(20000)
        //    .center([0, 55.4])
        //    .translate([width / 2, (height / 2)] );

        var projection = d3.geo.albers()
            .center([0, 55.4])
            .rotate([4.4, 0])
            .parallels([50, 60])
            .scale(6000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path().projection(projection);
        var colourScale = d3.scale.quantize()
            .domain([unqualified.summary.min_percent, unqualified.summary.max_percent])
            .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));
                            

        // Countries.
        svg.selectAll(".cntry")
            .data(topojson.object(countries, countries.objects.countries).geometries)
            .enter().append("path")
            .attr("class", function (d) { return "cntry " + d.id; })
            .attr("d", path);

        // Country bounaries.
        svg.append("path")
            .datum(topojson.mesh(countries, countries.objects.countries, function (a, b) { return a !== b }))
            .attr("d", path)
            .attr("class", "cntry-bndry");

        // Constituencies.
        svg.append("g")
            .attr("class", "YlGn")
            .selectAll(".constituency")
            .data(topojson.object(constituencies, constituencies.objects.constituencies).geometries)
            .enter().append("path")
            .attr("class", function (d) {
                return colourScale(unqualified.data[d.id].percent_unqual);

            })
            .attr("d", path);

        console.log(unqualified);


    </script>

    <div id="myjson"></div>
    <script>
    </script>
</body>
</html>