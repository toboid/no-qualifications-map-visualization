<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="libraries/d3.v3.min.js"></script>
    <script src="libraries/topojson.v0.js"></script>
    <script src="data/unqualified.js"></script>
    <script src="data/boundaries.js"></script>
    <script src="choropleth.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="colorbrewer.css" />
</head>
<body>
<!--    <svg id="mapSvg" width="960" height="1160" viewBox="0 0 960 1160">
        <filter id="dropshadow">
            <feGaussianBlur stdDeviation="10"/> 
        </filter>
    </svg>-->

    <script type="text/javascript">
        var body = d3.select("body");
        ts.choropleth.draw(body);
    </script>
    
    <!--<script>
        var svg = d3.select("#mapSvg"),
            width = svg.attr("width"),
            height = svg.attr("height"),
            centered,
            mapGrp = svg.append("g").attr("id", "mapGrp");

        var projection = d3.geo.albers()
            .center([0, 55.4])
            .rotate([4.4, 0])
            .parallels([50, 60])
            .scale(6000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path().projection(projection);

        var colourScale = d3.scale.quantize()
            .domain([unqualified.summary.min_percent, unqualified.summary.max_percent])
            .range(d3.range(9).map(function (i) { return "q" + i + "-9"; }));

        // External boundary.
        //mapGrp.append("path")
        //    .datum(topojson.mesh(boundaries, boundaries.objects.constituencies, function (a, b) { return a === b }))
        //    .attr("d", path)
        //    .attr("class", "cntry-bndry-ext");

        // Constituencies.
        mapGrp.append("g")
            .attr("class", "YlGn constituency")
            .attr("id", "constituencies")
            .selectAll("path")
            .data(topojson.object(boundaries, boundaries.objects.constituencies).geometries)
            .enter()
            .append("path")
            .attr("class", function (d) {
                return colourScale(unqualified.data[d.id].percent_unqual);
            })
            .attr("d", path)
            .on("click", click);

        function click(d) {
            var x, y, scaleFactor;

            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                scaleFactor = 4
                lineScaleFactor = 3;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                scaleFactor = 1;
                lineScaleFactor = 1;
                centered = null;
            }

            d3.selectAll("path")
                .classed("active", centered && function (d) {
                    return d === centered;
                });

            // Working but slow in Chrome
            mapGrp.transition()
                .duration(1000)
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + scaleFactor + ")translate(" + -x + "," + -y + ")");
           
            
            // Faster Transform
            //mapGrp.transition()
            //    .duration(1000)
            //    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")translate(" + -x + "," + -y + ")")
            //    .style("stroke-width", 0.8 / scaleFactor + "px");

            //var transformProp = (function (props) {
            //    var style = document.documentElement.style;
            //    for (var i = 0; i < props.length; i++) {
            //        if (props[i] in style) return {
            //            transform: 'transform',
            //            WebkitTransform: '-webkit-transform',
            //            OTransform: '-o-transform',
            //            MozTransform: '-moz-transform',
            //            msTransform: '-ms-transform'
            //        }[props[i]];
            //    }
            //    return false;
            //})(['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);

            //svg.transition()
            //    .duration(1000)
            //    .style(transformProp, "scale(" + scaleFactor + ")");
                  
            d3.transition()
                .duration(1000)
                .select("#constituencies")
                .style("stroke-width", 0.8 / lineScaleFactor + "px");
             
        }
    </script>-->
    
</body>
</html>