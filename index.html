<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="libraries/d3.v3.js"></script>
    <script src="libraries/topojson.v0.js"></script>
    <script src="data/unqualified.js"></script>
    <script src="data/boundaries.js"></script>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/colorbrewer.css" />
</head>
<body>
    <svg id="map" width="960" height="1160">
        <defs>
          <filter id="dropshadow">
              <feGaussianBlur stdDeviation="5"/> 
           </filter>
        </defs>
    </svg>
    <script>
        var svg = d3.select("#map");
        var width = svg.attr("width"),
            height = svg.attr("height");


        //var projection = d3.geo.mercator()
        //    .scale(20000)
        //    .center([0, 55.4])
        //    .translate([width / 2, (height / 2)] );

        var projection = d3.geo.albers()
            .center([0, 55.4])
            .rotate([4.4, 0])
            .parallels([50, 60])
            .scale(6000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path().projection(projection);
        var colourScale = d3.scale.quantize()
            .domain([unqualified.summary.min_percent, unqualified.summary.max_percent])
            .range(d3.range(9).map(function (i) { return "q" + i + "-9"; }));

        // External boundary.
        svg.append("path")
            .datum(topojson.mesh(boundaries, boundaries.objects.regions, function (a, b) { return a === b }))
            .attr("d", path)
            .attr("class", "cntry-bndry-ext");

        // Constituencies.
        svg.append("g")
            .attr("class", "Greens constituency")
            .selectAll("path")
            .data(topojson.object(boundaries, boundaries.objects.constituencies).geometries)
            .enter().append("path")
            .attr("class", function (d) {
                return colourScale(unqualified.data[d.id].percent_unqual);
            })
            .attr("d", path);

        // Regions.
        svg.append("g")
            .attr("class", "region")
            .selectAll("path")
            .data(topojson.object(boundaries, boundaries.objects.regions).geometries)
            .enter().append("path")
            .attr("d", path);

        console.log(topojson.object(boundaries, boundaries.objects.constituencies));
        console.log(topojson.object(boundaries, boundaries.objects.regions));

        // TODO - want this?
        boundaries = null;
    </script>
</body>
</html>